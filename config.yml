project:
  name: demo-process-observability

io:
  runs_dir: runs
  input_path: data/01_raw_messages.json
  output:
    normalized_messages: messages.normalized.jsonl

run:
  write_run_meta: true

normalize:
  sort_by_timestamp: true
  keep_raw: true
  allow_empty_text: true

llm:
  provider: openai
  model: ${OPENAI_MODEL}
  api_key_env: OPENAI_API_KEY
  temperature: 0
  max_output_tokens: 500
  timeout_s: 60
  max_retries: 3
  retry_backoff_s: 2

pass1:
  enabled: true
  output_events: events.pass1.jsonl
  output_errors: events.pass1.errors.jsonl
  prompt_path: src/demo/llm/prompts/pass1_event_extraction.md
  concurrency: 8
  min_confidence_to_keep: 0.0
  cache:
    enabled: true
    dir: cache/pass1

eval:
  # Stage 0: stub only. Stage 3.5 will implement.
  review_filename: review.json
  report_filename: eval_report.json

stage3:
  enabled: true
  input:
    events_pass1: events.pass1.jsonl
    normalized_messages: messages.normalized.jsonl
  output:
    instances: instances.json
    timeline: timeline.json
    review_template: review_template.json
    eval_report: eval_report.json
  clustering:
    method: thread_first
    min_event_confidence: 0.30
    allow_split_by_process: true
    max_threads_to_process: null
  pass2:
    model: ${OPENAI_MODEL}
    temperature: 0
    max_output_tokens: 900
    timeout_s: 90
    max_retries: 3
  evidence:
    max_items_per_instance: 7
    min_confidence: 0.30
  eval:
    review_filename: review.json
    labels:
      allowed: ["correct", "partial", "incorrect", "unsure"]

catalog:
  workflow_definition_path: "config/workflow_definition.yaml"
  process_catalog_path: "config/process_catalog.yml"
  override_path: "config/workflow_aliases_override.yml"

reconciliation:
  enabled: true

  store:
    persistent_path: data/workflow_store.json
    snapshot_name: workflow_store.snapshot.json

  scope:
    recruiting_only: true
    recruiting_process_keys: ["recruiting"]

  reconcile:
    match:
      method: key_then_fuzzy
      exact_key_fields: ["canonical_client", "canonical_role", "canonical_process"]
      fuzzy_threshold: 0.88
    evidence:
      max_ids_per_instance: 200
      timeline_fallback_max: 30

  inference:
    positional:
      enabled: true
      completed_label: completed_inferred

  reports:
    coverage_name: coverage_report.json
    reconciliation_name: reconciliation_report.json
    drift_name: mapping_drift_report.json
